<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="FinanKey.Presentacion.View.AnadirPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:bottomSheet="clr-namespace:Syncfusion.Maui.Toolkit.BottomSheet;assembly=Syncfusion.Maui.Toolkit"
    xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:editors="clr-namespace:Syncfusion.Maui.Inputs;assembly=Syncfusion.Maui.Inputs"
    xmlns:inputLayout="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
    xmlns:sfPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Background="{StaticResource ColorFondoPrincipal}"
    Shell.NavBarIsVisible="False">

    <!--  CONFIGURACIÓN DE LA BARRA DE ESTADO  -->
    <ContentPage.Behaviors>
        <toolkit:StatusBarBehavior StatusBarColor="{StaticResource FondoPrincipal}" StatusBarStyle="DarkContent" />
    </ContentPage.Behaviors>

    <!--  RECURSOS Y ESTILOS DE LA PÁGINA  -->
    <ContentPage.Resources>
        <ResourceDictionary>
            <!--  ESTILO DE SELECCIÓN DE GRID PARA BOTTOMSHEET DE CATEGORÍAS  -->
            <Style TargetType="Grid">
                <Setter Property="VisualStateManager.VisualStateGroups">
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">
                            <VisualState x:Name="Normal" />
                            <VisualState x:Name="Selected">
                                <VisualState.Setters>
                                    <Setter Property="BackgroundColor" Value="Transparent" />
                                </VisualState.Setters>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateGroupList>
                </Setter>
            </Style>

            <!--  ESTADOS VISUALES DEL SWITCH  -->
            <Style TargetType="buttons:SfSwitch">
                <Setter Property="VisualStateManager.VisualStateGroups">
                    <VisualStateGroupList>
                        <VisualStateGroup x:Name="CommonStates">
                            <VisualState x:Name="On">
                                <VisualState.Setters>
                                    <Setter Property="SwitchSettings">
                                        <Setter.Value>
                                            <buttons:SwitchSettings
                                                ThumbBackground="{StaticResource ColorAzulMarino}"
                                                ThumbStroke="{StaticResource ColorAzulMarino}"
                                                TrackBackground="{StaticResource ColorAzulMarinoSuave}"
                                                TrackStroke="{StaticResource ColorAzulMarino}" />
                                        </Setter.Value>
                                    </Setter>
                                </VisualState.Setters>
                            </VisualState>
                            <VisualState x:Name="Off">
                                <VisualState.Setters>
                                    <Setter Property="SwitchSettings">
                                        <Setter.Value>
                                            <buttons:SwitchSettings
                                                ThumbBackground="{StaticResource ColorMagenta}"
                                                ThumbStroke="{StaticResource ColorMagenta}"
                                                TrackBackground="{StaticResource ColorMagentaSuave}"
                                                TrackStroke="{StaticResource ColorMagenta}" />
                                        </Setter.Value>
                                    </Setter>
                                </VisualState.Setters>
                            </VisualState>
                        </VisualStateGroup>
                    </VisualStateGroupList>
                </Setter>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <!--  CONTENEDOR PRINCIPAL DEL BOTTOMSHEET  -->
    <bottomSheet:SfBottomSheet
        x:Name="bottomSheetCategoria"
        AllowedState="All"
        Background="{StaticResource FondoPrincipal}"
        BackgroundColor="{StaticResource ColorFondoPrincipal}"
        CollapseOnOverlayTap="True"
        CollapsedHeight="0"
        ContentWidthMode="Full"
        CornerRadius="20,20,0,0"
        GrabberBackground="{StaticResource ColorIconoNavBar}"
        GrabberHeight="5"
        GrabberWidth="90"
        IsModal="True"
        IsOpen="{Binding IsBottomSheetOpen}"
        State="Hidden">

        <!--  CONTENIDO PRINCIPAL  -->
        <bottomSheet:SfBottomSheet.Content>

            <Grid
                Padding="{StaticResource PaddingPaginas}"
                RowDefinitions="Auto,*"
                RowSpacing="16">

                <!--  BOTÓN FLOTANTE MEJORADO PARA GUARDAR  -->
                <Button
                    Grid.Row="1"
                    BackgroundColor="{StaticResource ColorAzulPricipal}"
                    Command="{Binding GuardarMovimientoCommand}"
                    CornerRadius="28"
                    HeightRequest="56"
                    HorizontalOptions="End"
                    ImageSource="icono_suma.svg"
                    VerticalOptions="End"
                    WidthRequest="56"
                    ZIndex="1" />

                <!--  INDICADOR DE CARGA  -->
                <ActivityIndicator
                    Grid.Row="0"
                    Grid.RowSpan="2"
                    BackgroundColor="Transparent"
                    HeightRequest="50"
                    HorizontalOptions="Center"
                    IsRunning="{Binding IsBusy}"
                    IsVisible="{Binding IsBusy}"
                    VerticalOptions="Center"
                    WidthRequest="50"
                    ZIndex="5"
                    Color="{StaticResource ColorAzulPricipal}" />

                <!--  VENTANA EMERGENTE MENSAJE DE INFORMACIÓN  -->
                <sfPopup:SfPopup
                    Padding="16"
                    AutoSizeMode="Height"
                    BackgroundColor="Transparent"
                    FooterHeight="57"
                    HeaderTitle="57"
                    HeightRequest="180"
                    HorizontalOptions="Center"
                    IsOpen="{Binding PopupInformacionAbierto}"
                    IsVisible="{Binding PopupInformacionAbierto}"
                    ShowCloseButton="False"
                    ShowFooter="True"
                    ShowHeader="True"
                    WidthRequest="380">
                    <sfPopup:SfPopup.PopupStyle>
                        <sfPopup:PopupStyle
                            FooterBackground="{StaticResource ColorFondoComponentes}"
                            HeaderBackground="{StaticResource ColorFondoComponentes}"
                            MessageBackground="{StaticResource ColorFondoComponentes}" />
                    </sfPopup:SfPopup.PopupStyle>
                    <!--  ENCABEZADO DEL POPUP  -->
                    <sfPopup:SfPopup.HeaderTemplate>
                        <DataTemplate>
                            <HorizontalStackLayout Margin="16,16,0,0">
                                <Label
                                    Style="{StaticResource TextoEncabezadoSecundario}"
                                    Text="Información"
                                    TextColor="{StaticResource ColorTexto}" />
                            </HorizontalStackLayout>
                        </DataTemplate>
                    </sfPopup:SfPopup.HeaderTemplate>
                    <!--  CONTENIDO DEL POPUP  -->
                    <sfPopup:SfPopup.ContentTemplate>
                        <DataTemplate>
                            <Label
                                Margin="16,0"
                                HorizontalOptions="Start"
                                Style="{StaticResource TextoParrafoPrincipal}"
                                Text="{Binding MensajeInformacion}"
                                TextColor="{StaticResource Secundario}" />
                        </DataTemplate>
                    </sfPopup:SfPopup.ContentTemplate>
                    <!--  PIE DEL POPUP  -->
                    <sfPopup:SfPopup.FooterTemplate>
                        <DataTemplate>
                            <Button
                                Margin="0,0,16,16"
                                BackgroundColor="{StaticResource ColorAzulPricipal}"
                                Command="{Binding CerrarPopInformacionCommand}"
                                CornerRadius="10"
                                FontFamily="PoppinsBold"
                                FontSize="14"
                                HeightRequest="42"
                                HorizontalOptions="End"
                                Text="OK"
                                TextColor="{StaticResource ColorFondoComponentes}" />
                        </DataTemplate>
                    </sfPopup:SfPopup.FooterTemplate>
                </sfPopup:SfPopup>

                <!--  VENTANA EMERGENTE MENSAJE DE ERROR  -->
                <sfPopup:SfPopup
                    Padding="16"
                    AutoSizeMode="Height"
                    BackgroundColor="Transparent"
                    FooterHeight="57"
                    HeaderTitle="57"
                    HorizontalOptions="Center"
                    IsOpen="{Binding PopupErrorAbierto}"
                    IsVisible="{Binding PopupErrorAbierto}"
                    ShowCloseButton="False"
                    ShowFooter="True"
                    ShowHeader="True"
                    WidthRequest="380">
                    <sfPopup:SfPopup.PopupStyle>
                        <sfPopup:PopupStyle
                            FooterBackground="{StaticResource ColorFondoComponentes}"
                            HeaderBackground="{StaticResource ColorFondoComponentes}"
                            MessageBackground="{StaticResource ColorFondoComponentes}" />
                    </sfPopup:SfPopup.PopupStyle>
                    <!--  ENCABEZADO DEL POPUP  -->
                    <sfPopup:SfPopup.HeaderTemplate>
                        <DataTemplate>
                            <VerticalStackLayout HorizontalOptions="Center" Spacing="4">
                                <Image
                                    Aspect="AspectFit"
                                    HorizontalOptions="Center"
                                    Source="icono_error.svg"
                                    VerticalOptions="Center" />
                                <Label
                                    Style="{StaticResource TextoEncabezadoSecundario}"
                                    Text="{Binding TituloError}"
                                    TextColor="{StaticResource ColorTexto}" />
                            </VerticalStackLayout>
                        </DataTemplate>
                    </sfPopup:SfPopup.HeaderTemplate>
                    <!--  CONTENIDO DEL POPUP  -->
                    <sfPopup:SfPopup.ContentTemplate>
                        <DataTemplate>
                            <Label
                                Margin="16,0"
                                HorizontalOptions="Start"
                                Style="{StaticResource TextoParrafoPrincipal}"
                                Text="{Binding MensajeError}"
                                TextColor="{StaticResource Secundario}" />
                        </DataTemplate>
                    </sfPopup:SfPopup.ContentTemplate>
                    <!--  PIE DEL POPUP  -->
                    <sfPopup:SfPopup.FooterTemplate>
                        <DataTemplate>
                            <Button
                                Margin="0,0,16,16"
                                BackgroundColor="{StaticResource ColorAzulPricipal}"
                                Command="{Binding CerrarPopErrorCommand}"
                                CornerRadius="10"
                                FontFamily="PoppinsBold"
                                FontSize="14"
                                HeightRequest="42"
                                HorizontalOptions="End"
                                Text="OK"
                                TextColor="{StaticResource ColorFondoComponentes}" />
                        </DataTemplate>
                    </sfPopup:SfPopup.FooterTemplate>
                </sfPopup:SfPopup>

                <!--  ZONA ESTÁTICA CON TÍTULO Y BOTONES PRINCIPALES  -->
                <StackLayout Spacing="16">
                    <!--  TÍTULO DE LA PÁGINA  -->
                    <Label
                        Grid.Row="0"
                        HeightRequest="32"
                        HorizontalOptions="Center"
                        Style="{StaticResource TextoSubtítulo}"
                        Text="Añadir Movimiento"
                        TextColor="{StaticResource ColorAzulPricipal}"
                        VerticalOptions="Center" />

                    <!--  LÍNEA DIVISORIA  -->
                    <BoxView
                        Grid.Row="1"
                        BackgroundColor="#D9D9D9"
                        HeightRequest="1"
                        HorizontalOptions="Fill" />

                    <!--  BOTONES TOGGLE PARA GASTO/INGRESO  -->
                    <HorizontalStackLayout
                        Grid.Row="2"
                        HorizontalOptions="Center"
                        Spacing="16">
                        <Button
                            x:Name="btnGasto"
                            BackgroundColor="{StaticResource ColorAzulPricipal}"
                            Command="{Binding InicializarDatosFormularioCommand}"
                            CommandParameter="Gasto"
                            ImageSource="icono_billetera_blanco.svg"
                            Pressed="btnGasto_Pressed"
                            Style="{StaticResource grupoBotones}"
                            Text="Gasto"
                            TextColor="{StaticResource TextoPrimario}" />

                        <Button
                            x:Name="btnIngreso"
                            BackgroundColor="{StaticResource ColorFondoComponentes}"
                            Command="{Binding InicializarDatosFormularioCommand}"
                            CommandParameter="Ingreso"
                            ImageSource="icono_billete_azul.svg"
                            Pressed="btnIngreso_Pressed"
                            Style="{StaticResource grupoBotones}"
                            Text="Ingreso"
                            TextColor="Black" />
                    </HorizontalStackLayout>

                    <!--  LÍNEA DIVISORIA  -->
                    <BoxView
                        Grid.Row="3"
                        BackgroundColor="#D9D9D9"
                        HeightRequest="1"
                        HorizontalOptions="Fill" />
                </StackLayout>


                <!--  ÁREA DESPLAZABLE CON FORMULARIOS  -->
                <ScrollView Grid.Row="1">
                    <Grid>
                        <!--  FORMULARIO PARA GASTOS  -->
                        <StackLayout
                            x:Name="formularioGasto"
                            IsVisible="True"
                            Spacing="16">
                            <!--  FILA DE MONTO Y FECHA  -->
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                                <!--  CAMPO DE MONTO  -->
                                <StackLayout Grid.Column="0" Spacing="8">
                                    <Label
                                        Style="{StaticResource TextoSubtítulo}"
                                        Text="Monto"
                                        TextColor="{StaticResource ColorAzulPricipal}" />
                                    <Border
                                        x:Name="borderMontoGasto"
                                        Stroke="{StaticResource Terciario}"
                                        StrokeShape="RoundRectangle 20"
                                        StrokeThickness="0.5"
                                        Style="{StaticResource bordeFormulario}">
                                        <Entry
                                            Focused="entradaMontoGasto_Focused"
                                            Keyboard="Numeric"
                                            Placeholder="0"
                                            PlaceholderColor="{StaticResource ColorPlaceholde}"
                                            Style="{StaticResource entradaFormulario}"
                                            Text="{Binding Monto, Mode=TwoWay}"
                                            Unfocused="entradaMontoGasto_Unfocused" />
                                    </Border>
                                </StackLayout>

                                <!--  CAMPO DE FECHA  -->
                                <StackLayout Grid.Column="1" Spacing="8">
                                    <Label
                                        Style="{StaticResource TextoSubtítulo}"
                                        Text="Fecha"
                                        TextColor="{StaticResource ColorAzulPricipal}" />
                                    <Border
                                        Stroke="{StaticResource Terciario}"
                                        StrokeShape="RoundRectangle 20"
                                        StrokeThickness="0.5"
                                        Style="{StaticResource bordeFormulario}"
                                        VerticalOptions="Center">
                                        <HorizontalStackLayout Padding="12,0" Spacing="16">
                                            <DatePicker
                                                x:Name="fechaTransaccionGasto"
                                                Background="Transparent"
                                                Date="{Binding Fecha, Mode=TwoWay}"
                                                FontFamily="PoppinsRegular"
                                                FontSize="16"
                                                Format="dd/MM/yyyy"
                                                HorizontalOptions="Center"
                                                TextColor="{StaticResource ColorPlaceholde}"
                                                VerticalOptions="Center" />
                                            <Image
                                                Aspect="AspectFit"
                                                HeightRequest="20"
                                                Source="icono_calderario.svg"
                                                VerticalOptions="Center"
                                                WidthRequest="20" />
                                        </HorizontalStackLayout>
                                    </Border>
                                </StackLayout>
                            </Grid>

                            <!--  CAMPO DE DESCRIPCIÓN  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Descripción"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    x:Name="borderDescripcionGasto"
                                    Stroke="{StaticResource Terciario}"
                                    StrokeShape="RoundRectangle 20"
                                    StrokeThickness="0.5"
                                    Style="{StaticResource bordeFormulario}">
                                    <HorizontalStackLayout Padding="12,0" Spacing="8">
                                        <Entry
                                            x:Name="entradaDescripcionGasto"
                                            Focused="entradaDescripcionGasto_Focused"
                                            HorizontalOptions="Fill"
                                            Placeholder="Ej: Compras comida"
                                            PlaceholderColor="{StaticResource ColorPlaceholde}"
                                            Style="{StaticResource entradaFormulario}"
                                            Text="{Binding Descripcion, Mode=TwoWay}"
                                            TextColor="{StaticResource ColorTexoEntrada}"
                                            Unfocused="entradaDescripcionGasto_Unfocused"
                                            WidthRequest="300" />
                                        <Image
                                            Aspect="AspectFit"
                                            HeightRequest="20"
                                            Source="icono_lapiz.svg"
                                            VerticalOptions="Center"
                                            WidthRequest="20" />
                                    </HorizontalStackLayout>
                                </Border>
                            </StackLayout>

                            <!--  CAMPO DE CATEGORÍA  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Categoría"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    BackgroundColor="{StaticResource ColorTarjeta}"
                                    HeightRequest="52"
                                    Stroke="{StaticResource Terciario}"
                                    StrokeShape="RoundRectangle 20"
                                    StrokeThickness="0.5">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding MostrarBottomSheetCategoriasCommand}" />
                                    </Border.GestureRecognizers>
                                    <Grid
                                        Padding="16,8"
                                        ColumnDefinitions="32,*,20"
                                        ColumnSpacing="12">
                                        <Image
                                            Grid.Column="0"
                                            Aspect="AspectFit"
                                            HeightRequest="45"
                                            Source="{Binding CategoriaSeleccionada.RutaIcono, Mode=TwoWay}"
                                            WidthRequest="35" />
                                        <Label
                                            Grid.Column="1"
                                            Style="{StaticResource TextoParrafoPrincipal}"
                                            Text="{Binding CategoriaSeleccionada.Descripcion, Mode=TwoWay}"
                                            TextColor="{StaticResource ColorTexoEntrada}"
                                            VerticalOptions="Center" />
                                        <Image
                                            Grid.Column="2"
                                            Aspect="AspectFit"
                                            HeightRequest="16"
                                            Source="icono_flecha_abajo.svg"
                                            WidthRequest="16" />
                                    </Grid>
                                </Border>
                            </StackLayout>

                            <!--  CAMPO DE SELECCIÓN DE TARJETA  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Tarjeta"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    BackgroundColor="{StaticResource ColorTarjeta}"
                                    Stroke="{StaticResource Terciario}"
                                    StrokeShape="RoundRectangle 20"
                                    StrokeThickness="0.5">
                                    <editors:SfComboBox
                                        x:Name="cmbTarjeta"
                                        Margin="8,0"
                                        DisplayMemberPath="Nombre"
                                        DropDownBackground="{StaticResource ColorFondoComponentes}"
                                        DropDownIconColor="{StaticResource ColorAzulPricipal}"
                                        DropDownPlacement="Top"
                                        DropDownStroke="{StaticResource ColorPlaceholde}"
                                        FontFamily="PoppinsRegular"
                                        FontSize="16"
                                        IsClearButtonVisible="False"
                                        IsEditable="true"
                                        IsFilteringEnabled="True"
                                        ItemsSource="{Binding ListaTarjetas, Mode=TwoWay}"
                                        NoResultsFoundText="Sin Resultado"
                                        Placeholder="Seleccionar Tarjeta"
                                        PlaceholderColor="#8C8C8C"
                                        SelectedItem="{Binding TarjetaSeleccionada, Mode=TwoWay}"
                                        SelectionTextHighlightColor="Transparent"
                                        Stroke="Transparent"
                                        TextColor="{StaticResource ColorTexoEntrada}"
                                        TextMemberPath="Nombre">
                                        <!--  PLANTILLA PARA ITEMS DE TARJETAS DÉBITO  -->
                                        <editors:SfComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <ViewCell>
                                                    <Grid
                                                        Padding="8,12"
                                                        ColumnDefinitions="32,*"
                                                        ColumnSpacing="12">
                                                        <Image
                                                            Grid.Column="0"
                                                            Aspect="AspectFit"
                                                            HeightRequest="20"
                                                            Source="{Binding Logo}"
                                                            WidthRequest="20" />
                                                        <StackLayout Grid.Column="1" Orientation="Horizontal">
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text="{Binding Nombre}"
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text=" - "
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text="{Binding Banco}"
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                        </StackLayout>
                                                    </Grid>
                                                </ViewCell>
                                            </DataTemplate>
                                        </editors:SfComboBox.ItemTemplate>
                                    </editors:SfComboBox>
                                </Border>
                            </StackLayout>

                            <!--  CAMPO DE COMERCIO  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Comercio"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    x:Name="borderComercio"
                                    Stroke="{StaticResource Terciario}"
                                    StrokeShape="RoundRectangle 20"
                                    StrokeThickness="0.5"
                                    Style="{StaticResource bordeFormulario}">
                                    <Entry
                                        Focused="entradaComercio_Focused"
                                        Placeholder="Ej: Walmart, Pali"
                                        PlaceholderColor="{StaticResource ColorPlaceholde}"
                                        Style="{StaticResource entradaFormulario}"
                                        Text="{Binding Comercio, Mode=TwoWay}"
                                        Unfocused="entradaComercio_Unfocused" />
                                </Border>
                            </StackLayout>

                            <!--  SWITCH DE ESTADO DE PAGO  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSecundario}"
                                    Text="¿Ya lo pagaste de la tarjeta?"
                                    TextColor="{StaticResource ColorTextosDescriptivos}" />
                                <buttons:SfSwitch
                                    x:Name="sfSwitch"
                                    HorizontalOptions="Start"
                                    IsOn="{Binding EstaPagado, Mode=TwoWay}" />
                            </StackLayout>

                        </StackLayout>

                        <!--  FORMULARIO PARA INGRESOS  -->
                        <StackLayout
                            x:Name="formularioIngreso"
                            IsVisible="False"
                            Spacing="16">
                            <!--  FILA DE MONTO Y FECHA  -->
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
                                <!--  CAMPO DE MONTO  -->
                                <StackLayout Grid.Column="0" Spacing="8">
                                    <Label
                                        Style="{StaticResource TextoSubtítulo}"
                                        Text="Monto"
                                        TextColor="{StaticResource ColorAzulPricipal}" />
                                    <Border
                                        x:Name="borderMontoIngreso"
                                        StrokeShape="RoundRectangle 20"
                                        Style="{StaticResource bordeFormulario}">
                                        <Entry
                                            Focused="entradaMontoIngreso_Focused"
                                            Keyboard="Numeric"
                                            Placeholder="0"
                                            PlaceholderColor="{StaticResource ColorPlaceholde}"
                                            Style="{StaticResource entradaFormulario}"
                                            Text="{Binding Monto, Mode=TwoWay}"
                                            Unfocused="entradaMontoIngreso_Unfocused" />
                                    </Border>
                                </StackLayout>

                                <!--  CAMPO DE FECHA  -->
                                <StackLayout Grid.Column="1" Spacing="8">
                                    <Label
                                        Style="{StaticResource TextoSubtítulo}"
                                        Text="Fecha"
                                        TextColor="{StaticResource ColorAzulPricipal}" />
                                    <Border StrokeShape="RoundRectangle 20" Style="{StaticResource bordeFormulario}">
                                        <HorizontalStackLayout Padding="12,0" Spacing="8">
                                            <DatePicker
                                                Background="Transparent"
                                                Date="{Binding FechaSeleccionada, Mode=TwoWay}"
                                                FontFamily="PoppinsRegular"
                                                FontSize="16"
                                                Format="dd/MM/yyyy"
                                                HorizontalOptions="Fill"
                                                TextColor="{StaticResource ColorPlaceholde}" />
                                            <Image
                                                Aspect="AspectFit"
                                                Source="icono_calderario.svg"
                                                VerticalOptions="Center" />
                                        </HorizontalStackLayout>
                                    </Border>
                                </StackLayout>
                            </Grid>

                            <!--  CAMPO DE DESCRIPCIÓN  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Descripción"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border StrokeShape="RoundRectangle 20" Style="{StaticResource bordeFormulario}">
                                    <HorizontalStackLayout Padding="12,0" Spacing="8">
                                        <Entry
                                            x:Name="entradaDescripcionIngreso"
                                            Focused="entradaDescripcionIngreso_Focused"
                                            Placeholder="Ej: Salario"
                                            PlaceholderColor="{StaticResource ColorPlaceholde}"
                                            Style="{StaticResource entradaFormulario}"
                                            Text="{Binding Descripcion, Mode=TwoWay}"
                                            TextColor="{StaticResource ColorTexoEntrada}"
                                            Unfocused="entradaDescripcionIngreso_Unfocused"
                                            WidthRequest="300" />
                                        <Image
                                            Aspect="AspectFit"
                                            HeightRequest="20"
                                            Source="icono_lapiz.svg"
                                            VerticalOptions="Center"
                                            WidthRequest="20" />
                                    </HorizontalStackLayout>
                                </Border>
                            </StackLayout>

                            <!--  CAMPO DE CATEGORÍA  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Categoría"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    BackgroundColor="{StaticResource ColorTarjeta}"
                                    HeightRequest="52"
                                    Stroke="{StaticResource ColorTarjeta}"
                                    StrokeShape="RoundRectangle 20">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding MostrarBottomSheetCategoriasCommand}" />
                                    </Border.GestureRecognizers>
                                    <Grid
                                        Padding="16,8"
                                        ColumnDefinitions="32,*,20"
                                        ColumnSpacing="12">
                                        <Image
                                            Grid.Column="0"
                                            Aspect="AspectFit"
                                            HeightRequest="35"
                                            Source="{Binding CategoriaSeleccionada.RutaIcono}"
                                            WidthRequest="35" />
                                        <Label
                                            Grid.Column="1"
                                            Style="{StaticResource TextoParrafoPrincipal}"
                                            Text="{Binding CategoriaSeleccionada.Descripcion}"
                                            TextColor="{StaticResource ColorTexoEntrada}"
                                            VerticalOptions="Center" />
                                        <Image
                                            Grid.Column="2"
                                            Aspect="AspectFit"
                                            HeightRequest="16"
                                            Source="icono_flecha_abajo.svg"
                                            WidthRequest="16" />
                                    </Grid>
                                </Border>
                            </StackLayout>

                            <!--  CAMPO DE SELECCIÓN DE TARJETA DÉBITO  -->
                            <StackLayout Spacing="8">
                                <Label
                                    Style="{StaticResource TextoSubtítulo}"
                                    Text="Tarjeta"
                                    TextColor="{StaticResource ColorAzulPricipal}" />
                                <Border
                                    BackgroundColor="{StaticResource ColorTarjeta}"
                                    Stroke="{StaticResource ColorTarjeta}"
                                    StrokeShape="RoundRectangle 20">
                                    <editors:SfComboBox
                                        Margin="8,0"
                                        DisplayMemberPath="Nombre"
                                        DropDownBackground="{StaticResource ColorFondoComponentes}"
                                        DropDownIconColor="{StaticResource ColorAzulPricipal}"
                                        DropDownPlacement="Top"
                                        DropDownStroke="{StaticResource ColorPlaceholde}"
                                        FontFamily="PoppinsRegular"
                                        FontSize="16"
                                        IsClearButtonVisible="False"
                                        IsEditable="true"
                                        IsFilteringEnabled="True"
                                        ItemsSource="{Binding ListaTarjetasDebito, Mode=TwoWay}"
                                        NoResultsFoundText="Sin Resultado"
                                        Placeholder="Seleccionar Tarjeta"
                                        PlaceholderColor="#8C8C8C"
                                        SelectedItem="{Binding TarjetaSeleccionada, Mode=TwoWay}"
                                        SelectionTextHighlightColor="Transparent"
                                        Stroke="Transparent"
                                        TextColor="{StaticResource ColorTexoEntrada}"
                                        TextMemberPath="Nombre">
                                        <editors:SfComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <ViewCell>
                                                    <Grid
                                                        Padding="8,12"
                                                        ColumnDefinitions="32,*"
                                                        ColumnSpacing="12">
                                                        <Image
                                                            Grid.Column="0"
                                                            Aspect="AspectFit"
                                                            HeightRequest="20"
                                                            Source="{Binding Logo}"
                                                            WidthRequest="20" />
                                                        <StackLayout Grid.Column="1" Orientation="Horizontal">
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text="{Binding Nombre}"
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text=" - "
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                            <Label
                                                                Style="{StaticResource TextoSecundario}"
                                                                Text="{Binding Banco}"
                                                                TextColor="{StaticResource ColorTexoEntrada}" />
                                                        </StackLayout>
                                                    </Grid>
                                                </ViewCell>
                                            </DataTemplate>
                                        </editors:SfComboBox.ItemTemplate>
                                    </editors:SfComboBox>
                                </Border>
                            </StackLayout>
                        </StackLayout>
                    </Grid>
                </ScrollView>
            </Grid>

        </bottomSheet:SfBottomSheet.Content>

        <!--  BOTON SHEET SELECCIONAR CATEGORIA  -->
        <bottomSheet:SfBottomSheet.BottomSheetContent>
            <CollectionView
                BackgroundColor="{StaticResource FondoPrincipal}"
                ItemsSource="{Binding ListaCategoriasActual}"
                SelectedItem="{Binding CategoriaSeleccionada, Mode=TwoWay}"
                SelectionChangedCommand="{Binding SeleccionarCategoriaCommand}"
                SelectionChangedCommandParameter="{Binding CategoriaSeleccionada}"
                SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid
                            Padding="16,12"
                            ColumnDefinitions="40,*"
                            ColumnSpacing="16">
                            <Image
                                Grid.Column="0"
                                Aspect="AspectFit"
                                HeightRequest="32"
                                Source="{Binding RutaIcono}"
                                WidthRequest="32" />
                            <Label
                                Grid.Column="1"
                                Style="{StaticResource TextoParrafoPrincipal}"
                                Text="{Binding Descripcion}"
                                TextColor="{StaticResource ColorTexoEntrada}"
                                VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </bottomSheet:SfBottomSheet.BottomSheetContent>

    </bottomSheet:SfBottomSheet>
</ContentPage>